---
import {getCollection, getEntry, render} from "astro:content";
import Post_layout from "../../layouts/post_layout.astro";
import {Image} from "astro:assets"
import Tag from "../../components/tag.astro";



export async function getStaticPaths() {
    const posts = await getCollection("posts");

    const paths = posts.map(post => ({
        params: {slug: post.id},
    }));
    return paths;
}
const {slug} = Astro.params;
const post = await getEntry("posts", slug)

const authors = []
for (const author of post.data.authors) {
    authors.push(await getEntry("authors", author))
}


if (!post) {
    throw new Error('Could not find blog post 1');
}

const images = import.meta.glob('../../assets/*.{jpg,jpeg,png,webp}', {
    eager: true,
    import: 'default'
});

const slug_post_image = "../" + post.data.image
const post_image = images[slug_post_image];
function WordCount(str: string) {
    return str.split(" ").length;
}
console.log(post_image)

const {Content} = await render(post)
const reading_time = Math.round(WordCount(post.body) / 200)
---
<html>
<head>
  <meta charset='utf-8'/>
  <link rel='icon' type='image/svg+xml' href='/favicon.svg'/>
  <meta name='viewport' content='width=device-width'/>
  <meta name='generator' content={Astro.generator}/>
  <link rel='stylesheet' href='/src/styles/global.css'/>
  <title>IMS-Stack</title>
</head>
<div class='bg-base-300'>
  <div class='mx-auto max-w-3xl pt-4 pb-8'>
    <Image
      src={post_image}
      alt='Photo'
      widths={[320, 640, 1024, 1600]}
      sizes='(max-width: 768px) 100vw, 768px'
      class='w-full h-auto rounded-xl shadow-md mt-10 mb-3'
    />
    <div>
      Author{authors.length > 1 ? "s" : ""}:
        {authors.map((author) => (
          <a href=`http://localhost:4321/author/${author.id}`
             class='mr-1 hover:underline'>{author.data.name}{authors.length - 1 == authors.indexOf(author) ? "" : ","}</a>
        ))}
    </div>
    <div>
      Lesezeit: etwa {reading_time} Minuten
    </div>

    <hr class='text-secondary mt-3 mb-4'>
    <div class='card-actions'>
        {
            post.data.tags.map(tag => (
                <Tag tag={tag}></Tag>
                )
            )
        }
    </div>
  </div>

  <Post_layout class='' post={post}>
    <Content/>
  </Post_layout>
</div>
</html>